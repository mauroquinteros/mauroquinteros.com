---
import MoonIcon from "./icons/Moon.astro";
import SunIcon from "./icons/Sun.astro";
---

<div class="relative size-6">
  <button
    id="light"
    data-toggle="dark"
    class="toggle-button absolute flex text-slate-600 dark:text-slate-200 appearance-none border-none transition-all backdrop-blur-md"
  >
    <MoonIcon class="size-6 pointer-events-none" />
  </button>
  <button
    id="dark"
    data-toggle="light"
    class="toggle-button absolute flex text-slate-600 dark:text-slate-200 appearance-none border-none transition-all backdrop-blur-md"
  >
    <SunIcon class="size-6 pointer-events-none" />
  </button>
</div>

<script is:inline>
  const darkMatchMedia = window.matchMedia("(prefers-color-scheme: dark)");

  const getThemePreference = () => {
    if (localStorage.theme) {
      return localStorage.theme;
    }

    return darkMatchMedia.matches ? "dark" : "light";
  };

  const setThemePreference = () => {
    const themePreference = getThemePreference();

    themePreference === "dark"
      ? document.documentElement.classList.add("dark")
      : document.documentElement.classList.remove("dark");

    document.querySelectorAll(".toggle-button").forEach((element) => {
      element.style.scale = element.id === themePreference ? "1" : "0";
    });
  };

  darkMatchMedia.addEventListener("change", setThemePreference);
  setThemePreference();

  document.querySelectorAll(".toggle-button").forEach((element) => {
    element.addEventListener("click", (event) => {
      localStorage.setItem("theme", event.target.dataset.toggle);
      setThemePreference();
    });
  });
</script>
